pipeline  {
    agent any 

    parameters {
        string (
            name: 'PYTHON_NODE',
            defaultValue: '172.31.16.456',
            description: 'Enter the target Ec2 for Python App'
        )

        string (
            name: 'WEB_NODE1',
            defaultValue: '172.31.22.123',
            description: 'Enter the target Ec2 for Web App'
        )

        string (
            name: 'WEB_NODE2',
            defaultValue: '172.31.22.123',
            description: 'Enter the target Ec2 for Web App'
        )

         

         
    }
    
    stages {
        
        stage ('Install Packages   SSH') {
            
            steps {
                sshagent (credentials: ['AWS-SSH-KEY']) {
                    sh """
                        ssh -o StrictHostKeyChecking=no ec2-user@${WEB_NODE1}
                        ssh -o StrictHostKeyChecking=no  ec2-user@${WEB_NODE2} '
                        sudo yum install git -y; 
                        sudo yum install nginx -y;
                        sudo systemctl start nginx; 
                        cd ~; rm -rf fruits-veg_market ;
                        git clone https://github.com/ahmedwoye/GroupAFruits-Veg-Market-One.git;
                        cd fruits-veg_market;
                        sed 's/FRUIT_MACHINE/${PYTHON_NODE}g'-i frontend/index.html;
                        sudo cp frontend/index.html  /usr/share/nginx/html/ ' 
                    """
                }

            }
        }
    }
}

